import random

from aiogram import types
from aiogram.dispatcher.filters.builtin import CommandStart
from aiogram.types import CallbackQuery

from data.config import load_config
from filters import IsPrivate
from keyboards.inline.main_menu_inline import start_keyboard
from loader import dp
from utils.db_api import db_commands


@dp.message_handler(IsPrivate(), CommandStart())
async def register_user(message: types.Message):
    try:
        if message.from_user.username is not None:
            await db_commands.add_user(name=message.from_user.full_name,
                                       telegram_id=message.from_user.id,
                                       username=message.from_user.username)

        else:
            await db_commands.add_user(name=message.from_user.full_name,
                                       telegram_id=message.from_user.id,
                                       username="None")


    except:
        pass
    support = await db_commands.select_user(telegram_id=load_config().tg_bot.support_ids[0])
    user_db = await db_commands.select_user(telegram_id=message.from_user.id)
    markup = await start_keyboard(status=user_db["status"])

    heart = random.choice(['ğŸ’™', 'ğŸ’š', 'ğŸ’›', 'ğŸ§¡', 'ğŸ’œ', 'ğŸ–¤', 'â¤', 'ğŸ¤', 'ğŸ’–', 'ğŸ’'])
    await message.answer(text=f"ĞŸÑ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑ Ğ²Ğ°Ñ, {message.from_user.full_name}!!\n\n"
                              f"{heart} <b> QueDateBot </b> - Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼ÑÑ‚Ğ².\n\n"
                              f"ğŸª§ ĞĞ¾Ğ²Ğ¾ÑÑ‚Ğ¸ Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ Ğ²Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ² Ğ½Ğ°ÑˆĞµĞ¼ ĞºĞ°Ğ½Ğ°Ğ»Ğµ - "
                              f"https://t.me/QueDateGroup \n\n"
                              f"<b>ğŸ¤ Ğ¡Ğ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾: </b>\n"
                              f"Ğ•ÑĞ»Ğ¸ Ñƒ Ğ²Ğ°Ñ ĞµÑÑ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¾ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğµ, Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ°Ğ³ĞµĞ½Ñ‚Ñƒ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¸ - "
                              f"@{support['username']}\n\n",
                         reply_markup=markup)


@dp.callback_query_handler(text="start_menu")
async def start_menu(call: CallbackQuery):
    user_db = await db_commands.select_user(telegram_id=call.from_user.id)
    support = await db_commands.select_user(telegram_id=load_config().tg_bot.support_ids[0])
    markup = await start_keyboard(user_db["status"])
    heart = random.choice(['ğŸ’™', 'ğŸ’š', 'ğŸ’›', 'ğŸ§¡', 'ğŸ’œ', 'ğŸ–¤', 'â¤', 'ğŸ¤', 'ğŸ’–', 'ğŸ’'])
    await call.message.edit_text(text=f"ĞŸÑ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑ Ğ²Ğ°Ñ, {call.from_user.full_name}!!\n\n"
                                      f"{heart} <b> QueDateBot </b> - Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼ÑÑ‚Ğ².\n\n"
                                      f"ğŸª§ ĞĞ¾Ğ²Ğ¾ÑÑ‚Ğ¸ Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ Ğ²Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ² Ğ½Ğ°ÑˆĞµĞ¼ ĞºĞ°Ğ½Ğ°Ğ»Ğµ - "
                                      f"https://t.me/QueDateGroup \n\n"
                                      f"ğŸ¤ <b> Ğ¡Ğ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾: </b>\n"
                                      f"Ğ•ÑĞ»Ğ¸ Ñƒ Ğ²Ğ°Ñ ĞµÑÑ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¾ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğµ, Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ°Ğ³ĞµĞ½Ñ‚Ñƒ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¸ - "
                                      f"@{support['username']}\n\n",
                                 reply_markup=markup)
